<template>
	<div id ="logScraper">
		<div id="head" class="row">
			<div class="col">
				<b>Latest activity</b>
			</div>
			<Filters v-model="filter"class="col text-right"/>
		</div>
		<div id="logs" class="row">
			<div v-for="(log, i) in list" :class="[(i==0)?'col-12':'col-6', 'logItem']">
				<div class="row">
					<div v-if="log.details.img" class="col-5 mainimg">
						<img :src="log.details.img"/>
					</div>
					<div class="col-7 description">
						<div class="row">
							<span><b>Liked</b> image</span>
						</div>
						<div class="row date">
							{{log.time|fromNow}}
						</div>
						<hr/>
						<div class="row pull-left actions">
							<b-button variant="danger" size="sm">Unlike it</b-button>
						</div>
					</div>
				</div>
			</div>
			<Loading v-if="!list"/>
			<div v-if="list instanceof Array && !list.length" class="text-center">
				<div>No logs available</div>
			</div>
		</div>
	</div>
</template>

<style scoped lang="scss">
	#logScraper {
		//height: 400px;
		//overflow-x: auto;
	}

	#head {
		line-height: 40px;
		background-color: $background-color-darker;
	}

	#logs {
		.logItem {
			padding: $spacer-small $spacer;
		}

		.mainimg img{
			width: 100%;
			min-height: 80px;
		}

		.date {
			font-size: $font-small;
		}
	}

	hr {
		margin-top:5px;
		margin-bottom: 7px;
		padding:0;
	}
</style>

<script>
	import moment from "moment";

	import Loading from "components/Loading.vue"
	import Filters from "./Filters.vue";

	var timer = false;

	moment.locale("en");
	export default {
		props: ["loggerid"],
		data () {
			return {
				list: false,
				filter: "all"
			}
		},
		mounted () {
			timer = setInterval(() => {
				this.$send("getLogs", {limit: 50, date: "latest", forWhich: this.loggerid, filter: this.filter})
			}, 3000);
		},
		message (action, data) {
			if (action == "logs" && data.forWhich == this.loggerID) {
				this.list = data.list;
			}
		},
		filters: {
			fromNow (date) {
				return moment(date).fromNow();
			}
		},
		watch: {
			filter () {
				this.list = false;
			}
		},
		components: {
			Loading,
			Filters
		}
	}
</script>